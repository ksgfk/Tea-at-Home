<!DOCTYPE html>
<!-- saved from url=(0035)https://www.natfrp.com/purchase/buy -->
<html lang="zh-CN" style="height: auto;">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <link rel="stylesheet" href="./css/fontawesome.min.css">
  <link rel="stylesheet" href="./css/adminlte.min.css">

  <!--
        We've purchased the "Starter" commercial license for this site: bmF0ZnJwLmNvbQ==
        Please concat this mail address if you have furtuer question: bGl1QGJvYm8ubW9l
        * Values above are base64 encoded for anti-spam purpose
    -->
  <link rel="stylesheet" href="./css/introjs.min.css">

  <link rel="stylesheet" href="./css/css">
  <script src=""></script>

  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript" async="" src="./css/analytics.js.下载"></script>
  <script src="./css/bootstrap.bundle.min.js.下载"></script>
  <script src="./css/adminlte.min.js.下载"></script>
  <script src="./js/cot.js"></script>

  <link rel="shortcut icon" href="https://www.natfrp.com/favicon.ico?v=2">

  <style>
    .introjs-tooltiptext {
      padding: 8px 20px !important;
    }

    .introjs-bullets {
      padding-top: 0 !important;
    }
  </style>



  <title>购买</title>
</head>

<body class="sidebar-mini" style="height: auto;" id="main">

  <div class="wrapper" id="ok">
    <nav class="main-header navbar navbar-expand navbar-white navbar-light" style="background-color:rgb(237,237,238);">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="">
            <img src="css/engin.png" alt="居茶" width="25px">
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="" title="退出登录" id="logout">
            登出
            <img src="css/Leave.png" alt="居茶" width="25px">
          </a>
        </li>
      </ul>
    </nav>
    <!-- Sidebar -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <a href="https://www.natfrp.com/user/" class="brand-link" style="text-align: center;">
        <span class="brand-text font-weight-light">
          TeaAtHome
        </span>
      </a>
      <div class="sidebar">
        <div class="user-panel mt-3 pb-3 mb-3 d-flex" style="">
          <img src="css/tea.png" alt="居茶">
          <div class="info">
            <a href="Home.html" class="d-block">
              name </a>
          </div>
        </div>
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false"
            id="Controller">

            <li class="nav-item">
              <a href="Home.html" class="nav-link">
                <img src="css/home2.png" width="30px" href="">
                <p>主页面</p>
              </a>
            </li>

            <li class="nav-item">
              <a id="nav-profile" href="ShoppingCart.html" class="nav-link">
                <img src="css/shop2.png" width="30px" href="">
                <p>购物车</p>
              </a>
            </li>

            <li class="nav-item">
              <a href="OrderDetails.html" class="nav-link">
                <img src="css/order2.png" width="30px" href="">
                <p>订单详情</p>
              </a>
            </li>

            <li class="nav-item">
              <a href="OrderDetails.html" class="nav-link active">
                <img src="css/search.png" width="30px" href="">
                <p>搜索</p>
              </a>
            </li>

          </ul>
        </nav>
      </div>
    </aside>
    <!-- Content -->
    <div class="content-wrapper" style="min-height: 854px; background-image: url( css/teas.jpg);">
      <div class="content" style="padding-top: 16px;">
        <style type="text/css">
          .fix-text p {
            margin-bottom: 4px;
          }

          .sub-heading {
            width: calc(100% - 16px);
            height: 0 !important;
            border-top: 1px solid #e9f1f1 !important;
            text-align: center !important;
            margin-top: 32px !important;
            margin-bottom: 40px !important;
            margin-left: 7px;
          }

          .sub-heading span {
            display: inline-block;
            position: relative;
            padding: 0 17px;
            top: -11px;
            font-size: 16px;
            color: #058;
            background-color: #fff;
          }

          .card-body {
            padding-top: 0;
            padding-bottom: 0;
          }

          h3,
          h5 {
            margin-bottom: 0;
          }
        </style>



        <div class="content">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-12">

                <div class="card" id="broadcast" style="background-color:beige;">
                  <div class="card-header border-0">
                    <div class="d-flex justify-content-between" style="align-items: center;">
                      <label></label>
                      <label></label>
                      <label></label>
                      <label></label>
                      <label></label>
                      <label>搜索信息</label>
                      <div class=" controls ">
                        <input id="find" type="text" placeholder="请输入您想搜索的内容"
                          style="background-color: rgba(237,237,238,0.5);width: 500px; ">
                      </div>
                      <div class=" actions ">
                        <button class=" btn btn-green " id="search">搜索！</button>
                      </div>
                      <label></label>
                      <label></label>
                      <label></label>
                      <label></label>
                      <label></label>
                    </div>
                  </div>
                  <div class="card-body fix-text fix-image" style="padding-top: 0;">
                    <p>
                    </p>
                  </div>
                </div>

              </div>
            </div>
            <div class="row" id="shower">

            </div>
          </div>
        </div>


        <div class="modal fade" id="modal-buy" style="display: none;" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title">请先扫码支付！</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="close1">
                  <span aria-hidden="true">×</span>
                </button>
              </div>
              <div class="modal-body">
                <a id="rewrite"></a>
                <img src="css/zfb.jpg" style="width: 460px;">
              </div>
              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="close">取消</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="continue">继续</button>
              </div>
            </div>
          </div>
        </div>
        <script>
          function add1() {
            console.log(document.getElementById("close").innerHTML);
            document.getElementById("close").onclick = function () {
              var b = document.getElementById("modal-buy");
              b.setAttribute("class", "modal fade");
              b.setAttribute("style", "display:none");
              var m = document.getElementById("main");
              m.setAttribute("class", "sidebar-mini");
              document.getElementById("awsl").remove();
            }
          }
          function add2() {
            document.getElementById("close1").onclick = function () {
              console.log("123");
              var b = document.getElementById("modal-buy");
              b.setAttribute("class", "modal fade");
              b.setAttribute("style", "display:none");
              var m = document.getElementById("main");
              m.setAttribute("class", "sidebar-mini");
              document.getElementById("awsl").remove();
            }
          }
          function add3() {
            console.log(document.getElementById("continue").innerHTML);
            document.getElementById('continue').onclick = function () {
              console.log("123");
              var b = document.getElementById("modal-buy");
              b.setAttribute("class", "modal fade");
              b.setAttribute("style", "display:none");
              var m = document.getElementById("main");
              m.setAttribute("class", "sidebar-mini");
              document.getElementById("awsl").remove();
              console.log(`id:${buyid},num:${buynum}`);
              console.log(buyid)
              $.ajax({
                type: "post",
                data: JSON.stringify({
                  productid: buyid.id,
                  count: buynum
                }),
                dataType: "json",
                contentType: 'application/json',
                url: 'buy/product',
                success: function (data, state) {
                  if (data.bok.success) {
                    alert("购买成功！");
                  } else {
                    alert("你有病吧！");
                  }
                }
              }).fail(()=>console.log('err'));

            }
          }

          add1();
          add2();
          add3();

        </script>
      </div>
    </div>

    <footer class="main-footer">
      <strong>
        <a href="index.html" style="color: rgba(175, 118, 31, 1);">Tea At Home</a>
        <div class="float-right d-none d-sm-inline-block">
          Designed by <b>福建居茶有限公司</b> &gt;_&lt;'"|
        </div>
      </strong>
    </footer>
    <div id="sidebar-overlay"></div>
  </div>


<!--  <script>-->
<!--    // AddProduct("122", "412421", "312424");-->
<!--  </script>-->
  <script>
    function getCookie(cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i].trim();
        if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
      }
      return "";
    }
    function setCookie(cname, cvalue, exdays) {
      var d = new Date();
      d.setTime(d.getTime() + (exdays * 60 * 60 * 1000));
      var expires = "expires=" + d.toGMTString();
      document.cookie = cname + "=" + cvalue + "; " + expires;
    }
    function delCookie(name) {
      var exp = new Date();
      exp.setTime(exp.getTime() - 1);
      var cval = getCookie(name);
      if (cval != null)
        document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
    }
    buyid = 0;
    buyname = "";
    buynum = 1;
    buyvalue = 0;
    count = 0;
    function AddProduct(tag, money, body2, id) {
      var container = document.getElementById('shower');
      var div6 = document.createElement("div");
      div6.setAttribute("class", "col-lg-6");
      {
        var div5 = document.createElement("div");
        div5.setAttribute("class", "card");
        {
          var div3 = document.createElement('div');
          div3.setAttribute("class", "card-header border-0");
          {
            var div4 = document.createElement('div');
            div4.setAttribute("class", "d-flex justify-content-between");
            {
              var h3 = document.createElement("h3");
              h3.innerHTML = tag;
              div4.appendChild(h3);
              var h5 = document.createElement("h5");
              h5.innerHTML = money;
              div4.appendChild(h5);
            }
            div3.appendChild(div4);
          }
          div5.appendChild(div3);
          var div2 = document.createElement('div');
          div2.setAttribute("class", "card-body");
          div2.innerHTML = `<p>${body2}</p>`;
          div5.appendChild(div2);
          var div1 = document.createElement('div');
          div1.setAttribute("class", "card-footer");
          {
            var button = document.createElement('button');
            button.type = "button";
            button.setAttribute('id', `buy[${count}]`);
            button.setAttribute("class", "btn btn-primary");
            button.innerHTML = "<img src=\"css/shop2.png\"style =\"width:30px\"> 立刻购买"
            function add() {
              button.onclick = function () {
                buymoney = money;
                buyname = tag;
                buyid = id;

                var a = document.getElementById("rewrite");
                a.innerHTML = `您将购买${buyname}产品，将会花费${buyvalue}元，请检查订单之后扫描二维码支付，并在支付成功之后单击继续。`;

                var b = document.getElementById("modal-buy");
                b.setAttribute("class", "modal fade show");
                b.setAttribute("style", "display:block");

                var m = document.getElementById("main");
                m.setAttribute("class", "sidebar-mini modal-open");
                var div12 = document.createElement("div");
                div12.setAttribute("id", "awsl");
                div12.setAttribute("class", "modal-backdrop fade show");
                var ok = document.getElementById("ok");
                ok.appendChild(div12);
              }
            }
            add();
            div1.appendChild(button);

            var button2 = document.createElement('button');
            button2.type = "button";
            button2.setAttribute('id', `buy[${count}]`);
            button2.setAttribute("class", "btn btn-primary");
            button2.innerHTML = "加入购物车"
            function add2() {
              button2.onclick = function () {
                $.ajax({
                type: "post",
                data: JSON.stringify({
                  productid: id.id,
                  count: 1
                }),
                dataType: "json",
                contentType: 'application/json',
                url: 'shoppingcar/add',
                success: function (data, state) {
                  if (data.bok.success) {
                    alert("加入成功！");
                  } else {
                    alert("你有病吧！");
                  }
                }
              }).fail(()=>console.log('err'));
              }
            }
            add2();
            div1.appendChild(button2);
          }
          div5.appendChild(div1);
        }
        div6.appendChild(div5);
      }
      container.appendChild(div6);
      count++;
    }


    function Clear() {
      var container = document.getElementById('shower');
      while (container.hasChildNodes()) {
        container.removeChild(container.lastChild);
      }
    }

    if (getCookie("username") == "") {
      $.ajax({
        type: "get",
        url: 'user/query_info',
        success: function (data, state) {
          if (data.success) {
            let usr = data.user;
            $name = usr.name;
            $user_gender = usr.sex;
            $user_id = usr.id;
            $permission = usr.permission;
            setCookie("username", $name, 30);
            setCookie("user_gender", $user_gender, 30);
            setCookie("user_id", $user_id, 30);
            setCookie("permission", $permission, 30);
          } else {
            alert("请登录！")
            location.href = 'login.html';
          }
        }
      });
    } else {
      $name = getCookie("username");
      $user_gender = getCookie("user_gender");
      $user_id = getCookie("user_id");
      $permission = getCookie("permission");
    }
    console.log($permission)
    if ($permission == 1){
      console.log('tr')
      AddController();
    }

  </script>
  <script>
    (function () {
      $('#search').click(function () {
        $.ajax({
          type: "post",
          url: 'product/fuzzy_query',
          data: JSON.stringify({
            key: $('#find').val()
          }),
          dataType: "json",
          contentType: 'application/json',
          success: function (data, state) {
            console.log(data);
            if (data.length !== 0) {
              Clear();
              data.forEach(i => {
                var name = i.name;
                var price = i.price + "/斤";
                var jiesao = `这是${i.name}茶，非常牛逼建议买爆，99斤点击就买！`;
                AddProduct(name, price, jiesao, i);
              });
            } else {
              alert("找不到哦！");
            }
          }
        }).fail(function () {
          alert("cnm");
        });
      });
    })();
  </script>
</body>
<div style="all: initial;">
  <div id="__hcfy__" style="all: initial;"></div>
</div>

</html>